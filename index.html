<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>novatex</title>
  <link rel="stylesheet" href="css/common.css" />
  <style>
    section {
      min-height: calc(100vh - 80px);
    }
    section .banner {
      margin: auto;
      height: calc(100vh - 40px);
      box-shadow: 1px 2px 1px 1px #ccc;
      background: lightsalmon;
    }
    section ul {
      margin: auto;
      padding: 2vw 0;
      display: flex;
      flex-wrap: wrap;
      /*border-top: 1px solid #ddd;*/
    }
    section ul li {
      margin: 1vw 0 0 1.33vw;
      width: 20vw;
      height: 30vw;
      min-width: 110px;
      min-height: 180px;
      border: 1px solid #eee;
      box-shadow: 1px 1px 1px 1px #ddd;
    }
    section ul li:hover {
      box-shadow: 0 4px 4px 1px #bbb;
    }
    section ul li:nth-of-type(4n+1) {
      margin-left: 0;
    }
    section ul li dl dt {
      padding: .4vw;
      height: 20vw;
      background: #eee;
    }
    /*section ul li dl dt:hover {*/
      /*cursor: pointer;*/
      /*opacity: .2;*/
      /*background: #0f0;*/
    /*}*/
    section ul li dl dt img {
      width: 100%;
      height: 100%;
      box-shadow: 0 0 4px 2px #ccc;
    }
    section ul li dl dd {
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      align-items: center;
      padding: 0.4vw 0 1vw;
      height: 10vw;
    }
    section ul li dl dd span {
      font-size: 0.9vw;
      color: #aaa;
    }
    section ul li dl dd b {
      color: #f00;
    }
    section ul li dl dd a.get-btn {
      padding: 0.4vw 4vw;
    }

    .register,
    .login {
      z-index: 1;
      position: fixed;
      top: 50%;
      left: 50%;
      display: none;
      transition: 1s;
      transform: translateX(-50%) translateY(-50%);
      padding: 50px 30px;
      width: 400px;
      height: 300px;
      box-shadow: 0 2px 2px 1px #ccc;
      background: rgba(255,255,255,.6);
    }
    .register i,
    .register b {
      cursor: pointer;
      position: absolute;
    }
    .register i {
      top: 0;
      right: 10px;
      transform: rotate(45deg);
      font-size: 30px;
      color: #ccc;
    }
    .register b {
      right: 30px;
      bottom: 36px;
      padding: 6px 14px;
      border-radius: 2px;
      box-shadow: 1px 1px 1px #ccc;
      font-size: 14px;
      color: rgba(33,163,213,.6);
      /*color: rgba(145,181,77,1);*/
    }
    .register input {
      width: 100%;
      height: 36px;
      /*border-radius: 8px/4px;*/
      /*box-shadow: inset 0 2px 2px 2px #eee;*/
      background: transparent;
      text-indent: 10px;
      color: #fff;
    }
    .register input:nth-of-type(2) {
      margin: 26px 0 30px;
    }
    .register a {
      cursor: pointer;
      display: block;
      padding: 0;
      line-height: 40px;
      /*box-shadow: 1px 1px 1px rgba(145,181,77,.8);*/
      /*background: rgba(145,181,77,1);*/
      background: rgba(33,163,213,.6);
    }
  </style>
</head>
<body>
  <div class="register" style="display: none">
    <i>+</i>
    <b>or&nbsp;登录</b>
    <input type="text" placeholder="邮箱" />
    <input type="password" placeholder="密码" />
    <a class="get-btn register-sure">注册</a>
  </div>
  <div class="login register">
    <i>+</i>
    <b>else&nbsp;注册</b>
    <input type="text" placeholder="邮箱" />
    <input type="password" placeholder="密码" />
    <a class="get-btn login-sure">登录</a>
  </div>
  <div id="header-wrap">
    <header class="autoWidth">
      <ul class="moreNav">
        <li><a href="html/cart.html">购物袋&nbsp;<i>(2)</i></a></li>
        <li><a href="html/order.html">订单</a></li>
        <li><a href="#" id="account">账户</a></li>
      </ul>
      <a href="#" id="logo">novatex</a>
      <b class="cart"></b>
    </header>
  </div>
  <section>
    <div class="autoWidth banner"></div>
    <ul class="autoWidth lists">
      <!--<li>-->
        <!--<dl>-->
          <!--<dt></dt>-->
          <!--<dd>-->
            <!--<span>SFJ-3335</span>-->
            <!--<b>RMB 225</b>-->
            <!--<a href="#" class="get-btn">添加到购物袋</a>-->
          <!--</dd>-->
        <!--</dl>-->
      <!--</li>-->
    </ul>
  </section>
  <div id="footer-wrap">
    <footer class="autoWidth">
      <p>© 诺华（杭州）纺织有限公司 - 2017 NOVATEX Inc.</p>
    </footer>
  </div>

  <script src="js/data.js"></script>
  <script src="js/common.js"></script>
  <script>

    dataCarts = JSON.parse(localStorage.getItem('dataCarts')) || dataCarts;
    dataUsers = JSON.parse(localStorage.getItem('dataUsers')) || dataUsers;
//    console.log(dataUsers);
    const section = document.querySelector('section');
    const listsGoods = section.querySelector('ul');
    const account = document.querySelector('#account');

    //是否已登录
    for (let e of dataUsers) {
      if (e.isLogin) {
        account.innerText = '退出';
        break;
      }
    }

    (() => {
      //登录,退出
      account.addEventListener('click', function () {
        const text = account.innerText;
        if (text === '账户') {
          login.style.display = 'block';
        } else if (text === '退出') {
          for (let e of dataUsers) {
            if (e.isLogin) {
              e.isLogin = false;
              account.innerText = '账户';
              localStorage.setItem('dataUsers', JSON.stringify(dataUsers));
              break;
            }
          }
        }
      });

      //注册,登录-UI
      const register = document.querySelector('.register');
      const login = document.querySelector('.login');
      login.children[0].addEventListener('click', function () {
        login.style.display = '';
      });
      register.children[0].addEventListener('click', function () {
        register.style.display = '';
      });
      login.children[1].addEventListener('click', function () {
        loginChange(login, register);
      });
      register.children[1].addEventListener('click', function () {
        loginChange(register, login);
      });

      //注册,登录
      (() => {
        const registerSure = document.querySelector('.register .register-sure');
        const loginSure = document.querySelector('.login .login-sure');
        registerSure.addEventListener('click', function () {
          const sData = {
            id: +new Date(),
            email: registerSure.previousElementSibling.previousElementSibling.value,
            password: registerSure.previousElementSibling.value,
            isLogin: false
          };
          dataUsers.push(sData);
          localStorage.setItem('dataUsers', JSON.stringify(dataUsers));
          loginChange(register, login);
        });
        loginSure.addEventListener('click', function () {
          const email = loginSure.previousElementSibling.previousElementSibling.value;
          const password = loginSure.previousElementSibling.value;
          for (let e of dataUsers) {
            if (e.email === email && e.password === password) {
              e.isLogin = true;
              login.style.display = 'none';
              account.innerText = '退出';
              localStorage.setItem('dataUsers', JSON.stringify(dataUsers));
              break;
            }
          }
        });
      })();

      function loginChange(a, b) {
        a.style.transform = "translateX(-50%) translateY(-50%) rotateY(90deg)";
        b.style.display = 'block';
        b.style.transform = "translateX(-50%) translateY(-50%) rotateY(-90deg)";
        setTimeout(() => {
          b.style.transform = "translateX(-50%) translateY(-50%) rotateY(0deg)";
          a.style.display = 'none';
        }, 1000);
      }
    })();

    goodShow();
    //生成产品列表
    function goodShow() {
      let str = '';
      dataGoods.forEach(e => {
        str += `
          <li>
          <dl>
            <dt><img src="${e.pic}" /></dt>
            <dd>
              <em style="display: none">${e.id}</em>
              <span>${e.name}</span>
              <b>RMB ${e.price}</b>
              <a href="javascript:;" class="get-btn cartAdd">添加到购物袋</a>
            </dd>
          </dl>
        </li>
        `;
      });
      listsGoods.innerHTML = str;
      goodEvents();
    }
    function goodEvents() {
      const cartAdds = listsGoods.querySelectorAll('.cartAdd');
      cartAdds.forEach(e => {
        e.addEventListener('click', function () {
          const id = +e.parentNode.firstElementChild.innerText;
          let sData = [];
          let isInclude = false;
          dataGoods.forEach(e => {
            if (e.id === id) {
              sData = JSON.parse(JSON.stringify(e));
            }
          });
          dataCarts.forEach(e => {
            if (e.id === sData.id) {
              e.num++;
              isInclude = true;
            }
          });
          if (!isInclude) {
            sData.num = 1;
            dataCarts.push(sData);
          }
          localStorage.setItem('dataCarts', JSON.stringify(dataCarts));
        });
      });
    }
  </script>
</body>
</html>